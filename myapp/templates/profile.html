{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/modals.css' %}">

<div class="w3-container">
    <div class="w3-twothird w3-card-2 w3-round-large w3-white">
        <div class="w3-center">
            <img class="foto_profilo" src="{{request.user.foto_profilo.url}}" id="output" style="width: 300px">
        </div>
        <h2 class="w3-text-cyan w3-cursive w3-center">{{ user.nome }} {{ user.cognome }}</h2>
        {% if not user.tipo_utente %}
        <p>
            <i class="fa fa-briefcase fa-fw w3-margin-left w3-margin-right w3-large w3-text-cyan"></i>Paziente
        </p>
        {% else %}
        <p>
            <i class="fa fa-briefcase fa-fw w3-margin-left w3-margin-right w3-large w3-text-cyan"></i>Dottore
        </p>
        {% endif %}
        <p>
            <i class="fa fa-envelope fa-fw w3-margin-left w3-margin-right w3-large w3-text-cyan"></i>{{ user.email }}
        </p>
        <p>
            <i class="fa fa-phone fa-fw w3-margin-left w3-margin-right w3-large w3-text-cyan"></i>{{ user.telefono }}
        </p>
        <div class="w3-center">
            <button onclick="openModal('editing')" class="w3-btn w3-round-large w3-blue">Modifica dati</button>
        </div>
        <hr />
        {% if user.tipo_utente is True %}
        {% if studio %}

        <p class="w3-padding w3-large w3-text-black"><strong>Studio: </strong> Via {{studio.via}}
            N.{{studio.civico}}, {{studio.citta}} ({{studio.provincia}})
            <button onclick="openModal('studioModal')"
                class="w3-btn w3-round-large w3-blue w3-right-align">Modifica</button>
        </p>

        {% else %}
        <p class="w3-center w3-text-black w3-margin-bottom"><strong>Non hai ancora indicato uno studio.</strong>
            <a class="w3-margin-right w3-round-large" href="javascript:void(0)"
                onclick="openModal('studioModal')">Clicca
                qui per aggiungerlo!</a>
        </p>
        {% endif %}
        {% endif %}


    </div>

</div>

<div id="editing" class="modal" style="display: none;">
    <div class="modal-content">
        <span onclick="closeModal('editing')" class="close">&times;</span>
        <h2>Modifica il Profilo</h2>
        <form method="post" action="{% url 'edit_profile' %}" enctype="multipart/form-data" class="edit-profile-form"
            onsubmit="return confirm('Sei sicuro di voler modificare i dati come inseriti?')">
            {% csrf_token %}
            {{ form|crispy }}

            <!-- Container for the submit button -->
            <div class="submit-container">
                <button type="submit" class="w3-btn w3-green w3-round">Salva</button>
            </div>
        </form>
    </div>
</div>

<div id="studioModal" class="modal">
    <div class="modal-content w3-animate-opacity ">
        <span onclick="closeModal('studioModal')" class="close">&times;</span>
        <h2>Aggiungi/Modifica Studio</h2>
        <form method="post" action="{% url 'edit_studio' %}"
            onsubmit="return confirm('Sei sicuro di voler modificare lo studio con i seguenti campi? ')">
            {% csrf_token %}
            {{ studioform|crispy }}
            <div class="w3-center w3-margin-top w3-margin-bottom">
                <button type="submit" class="w3-btn w3-green w3-round">Salva</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'block';
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    window.onclick = function (event) {
        var editingModal = document.getElementById("editing");
        var studioModal = document.getElementById("studioModal");

        if (event.target == editingModal) {
            editingModal.style.display = "none";
        }
        if (event.target == studioModal) {
            studioModal.style.display = "none";
        }
    }
</script>
{% endblock %}